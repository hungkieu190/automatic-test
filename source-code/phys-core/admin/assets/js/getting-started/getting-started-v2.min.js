!function(t,e){function s(e,s){t(window).trigger(e,s)}var i=Backbone.Router.extend({routes:{"":"start","step-:step":"step"},start:function(){this.goToStep(0)},goToStep:function(t){this.navigate("step-"+t,{trigger:!0})},step:function(t){s("phys_gs_change_step",t)},initialize:function(){Backbone.history.start()}}),n=Backbone.Model.extend({initialize:function(){console.log("Model Phys_GS_Model Initialize!")},defaults:{isRunning:!1}}),a=Backbone.View.extend({el:".phys-getting-started",router:!1,model:null,base_url_ajax:phys_gs.url_ajax,steps:phys_gs.steps,current_step:0,events:{"click .tc-skip-step":"onSkipStep","click .tc-run-step":"onClickRunStep"},initialize:function(){var s=this;t(window).on("phys_gs_change_step",(function(t,e){s.goToStep(e)})),t(window).on("phys_gs_complete",(function(){s._request("finish",null).success((function(t){console.log(t)}))})),t(window).on("keyup",(function(t){switch(t.keyCode){case 37:s.backStep();break;case 39:s.nextStep();break;case 13:s.triggerClickRunCurrentStep()}})),this.model=new n,this.model.on("change:isRunning",this.toggleButtonSkip.bind(this)),this.router=new i,this.render(),e.complete((function(t){var i=t.action,n=t.slug,a=s.$('.phys-table-plugins tr[data-plugin="'+n+'"]');"activate"===i&&a.removeClass("processing"),1===e.count()&&(s.$(".phys-table-plugins").removeClass("running"),s.model.set("isRunning",!1),s.nextStep())})),e.success((function(t,e){if("activate"===e.action){var i=e.slug,n=s.$('.phys-table-plugins tr[data-plugin="'+i+'"]');t&&t.success?(n.removeClass("inactive processing").addClass("active").find(".phys-input").prop("checked",!1),n.find(".updating-message").text("Active")):(n.removeClass("processing").addClass("failed"),n.find(".updating-message").text("You can try again later :)"))}})),e.error((function(t){if("activate"===t.action){var e=t.slug,i=s.$('.phys-table-plugins tr[data-plugin="'+e+'"]');i.addClass("failed"),i.find(".updating-message").text("You can try again later :)")}}))},render:function(){this.updateHeightMain()},updateHeightMain:function(){var e=this.$(".tc-step"),s=1;e.each((function(){var e=t(this).height();e>s&&(s=e)})),this.$("main").height(s)},onSkipStep:function(t){t.preventDefault(),this.nextStep()},toggleButtonSkip:function(){this.model&&(this.model.get("isRunning")?this.$(".tc-skip-step").hide():this.$(".tc-skip-step").show())},goToStep:function(t){t>=this.steps.length&&(t=0),this.current_step=parseInt(t),this.steps.length-1===this.current_step&&s("phys_gs_complete"),this.$(".tc-number-step .current").text(this.current_step+1),this.current_step+1===this.steps.length?this.$(".tc-skip-step").hide():this.$(".tc-skip-step").show();var e=this.$(".tc-run-step");e.removeClass("updating-message"),e.attr("disabled",!1),this.hideAllStep();var i=this.getKeyCurrentKeyStep();this.$(".tc-step."+i).addClass("active"),this.updateControls()},getCurrentStep:function(){var t=this.current_step;return this.steps[t]},getKeyCurrentKeyStep:function(){return this.getCurrentStep().key},hideAllStep:function(){this.$(".tc-step").removeClass("active")},triggerClickRunCurrentStep:function(){var t=this.getKeyCurrentKeyStep();this.$(".tc-step."+t).find(".tc-run-step").click()},nextStep:function(){this.current_step!==this.steps.length-1&&(this.current_step++,this.router.goToStep(this.current_step))},backStep:function(){this.current_step&&(this.current_step--,this.router.goToStep(this.current_step))},updateControls:function(){var e=this.$(".tc-controls .step");e.removeClass("active current");var s=this.current_step;e.each((function(){var e=t(this),i=parseInt(e.attr("data-position"));if(i<=s&&e.addClass("active"),i===s){e.addClass("current");var n=e.attr("data-step");t(".tc-step."+n).addClass("active")}}))},onClickRunStep:function(e){if(this.current_step!==this.steps.length-1){var s=t(e.target);if(s.addClass("updating-message").attr("disabled",!0),s.is("a"))window.location.href=s.attr("href");else switch(this.getKeyCurrentKeyStep()){case"quick-setup":this._request_quick_setup();break;case"install-plugins":this._request_install_plugins();break;case"updates":this._login_envato(e);break;default:this.nextStep()}}},_login_envato:function(e){t(e.target).closest("form").submit()},_request:function(e,s){var i=this.base_url_ajax+e;return t.ajax({url:i,method:"POST",data:s,dataType:"json"})},_request_quick_setup:function(){var t=this.$(".quick-setup form").serialize(),e=this;e.model.set("isRunning",!0),this._request("quick-setup",t).success((function(){e.model.set("isRunning",!1),e.nextStep()})).error((function(t){console.error(t)}))},_request_install_plugins:function(){if(Phys_Core.check_active()){var s=this;this.model.set("isRunning",!0),this.$(".phys-table-plugins").addClass("running");var i=this.$(".phys-plugins input.phys-input:checked");if(!i||!i.length)return this.model.set("isRunning",!1),this.$(".phys-table-plugins").removeClass("running"),void s.nextStep();i.each((function(){var i=t(this),n=i.val(),a=i.attr("data-status");s.$('.phys-table-plugins tr[data-plugin="'+n+'"]').addClass("processing"),"not_installed"===a&&e.push({action:"install",slug:n}),e.push({action:"activate",slug:n})}))}}});t(document).ready((function(){new a}))}(jQuery,Phys_Plugins_Queue);
